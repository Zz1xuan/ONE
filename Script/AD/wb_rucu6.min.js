#!update = 2024-06-226 11:07
const url=$request.url;if(!$response.body)$done({});let body=$response.body;const itemMenusConfig={creatortypeask:false,mblog_menus_apeal:true,mblog_menus_avatar_widget:false,mblog_menus_bullet_shield:true,mblog_menus_card_bg:false,mblog_menus_comment_manager:true,mblog_menus_copy_url:true,mblog_menus_custom:false,mblog_menus_delete:true,mblog_menus_edit:true,mblog_menus_edit_history:true,mblog_menus_edit_video:true,mblog_menus_favorite:true,mblog_menus_follow:true,mblog_menus_home:false,mblog_menus_long_picture:true,mblog_menus_modify_visible:true,mblog_menus_novelty:false,mblog_menus_open_reward:false,mblog_menus_popularize:false,mblog_menus_promote:false,mblog_menus_report:true,mblog_menus_shield:true,mblog_menus_sticking:true,mblog_menus_video_feedback:false,mblog_menus_video_later:false};if(url.includes("/interface/sdk/sdkad.php")){let obj=JSON.parse(body.substring(0,body.length-2));if(obj?.needlocation){obj.needlocation=false}if(obj?.show_push_splash_ad){obj.show_push_splash_ad=false}if(obj?.background_delay_display_time){obj.background_delay_display_time=31536000}if(obj?.lastAdShow_delay_display_time){obj.lastAdShow_delay_display_time=31536000}if(obj?.realtime_ad_video_stall_time){obj.realtime_ad_video_stall_time=0}if(obj?.realtime_ad_timeout_duration){obj.realtime_ad_timeout_duration=0}if(obj?.ads?.length>0){for(let item of obj.ads){item.displaytime=0;item.displayintervel=31536000;item.allowdaydisplaynum=0;item.begintime="2040-01-01 00:00:00";item.endtime="2040-01-01 23:59:59"}}$done({body:JSON.stringify(obj)+"OK"})}else{let obj=JSON.parse(body);if(url.includes("/2/cardlist")){if(obj?.cards?.length>0){let newCards=[];for(let card of obj.cards){if(card?.card_group?.length>0){let newGroup=[];for(let group of card.card_group){let cardType=group.card_type;if([120,145,192]?.includes(cardType)){continue}if([6,101]?.includes(cardType)){continue}if(group?.mblog){removeAvatar(group?.mblog)}newGroup.push(group)}card.card_group=newGroup;newCards.push(card)}else{let cardType=card.card_type;if([17,58]?.includes(cardType)){continue}if(card?.mblog){removeAvatar(card?.mblog)}newCards.push(card)}}obj.cards=newCards}}else if(url.includes("/2/client/publisher_list")){if(obj?.elements?.length>0){obj.elements=obj.elements.filter((i)=>i.app_name==="写微博"||i.app_name==="图片"||i.app_name==="视频")}}else if(url.includes("/2/comments/build_comments")){if(obj?.datas?.length>0){let newItems=[];for(let item of obj.datas){if(item?.data){if(!isAd(item?.data)){if(item?.data?.user){removeAvatar(item?.data);if(["超话社区","微博开新年","微博热搜","微博视频"]?.includes(item.data?.user?.name)){continue}}if(item?.data?.comment_bubble){delete item.data.comment_bubble}if(item?.data?.comment_bullet_screens_message){delete item.data.comment_bullet_screens_message}if(item?.data?.hot_icon){delete item.data.hot_icon}if(item?.data?.vip_button){delete item.data.vip_button}if(item?.type===6||item?.type===15){continue}if(item?.adType==="相关内容"||item?.adType==="相关评论"||item?.adType==="推荐"){continue}newItems.push(item)}}}obj.datas=newItems}else if(obj?.root_comments?.length>0){let newItems=[];for(let item of obj.root_comments){if(!isAd(item)){if(item.user){removeAvatar(item);if(item?.user?.name==="超话社区"||item?.user?.name==="微博视频"){continue}}if(item?.comment_bubble){delete item.comment_bubble}if(item?.comment_bullet_screens_message){delete item.comment_bullet_screens_message}if(item?.hot_icon){delete item.hot_icon}if(item?.vip_button){delete item.vip_button}newItems.push(item)}}obj.root_comments=newItems}else if(obj?.comments?.length>0){let newItems=[];for(let item of obj.comments){if(item?.user?.icons){delete item.user.icons}if(item?.reply_comment?.comment_badge){delete item.reply_comment.comment_badge}newItems.push(item)}obj.comments=newItems}if(obj?.rootComment){if(obj?.rootComment?.comment_bubble){delete obj.rootComment.comment_bubble}}if(obj?.status?.page_info){removeVoteInfo(obj?.status)}}else if(url.includes("/2/container/asyn")){if(obj?.items?.length>0){let newItems=[];for(let item of obj.items){removeAvatar(item?.data);if(/infeed_may_interest_in/.test(item?.itemId)){continue}if(item?.itemId===null){continue}if(item?.items?.length>0){for(let i of item.items){removeVoteInfo(i?.data)}}newItems.push(item)}obj.items=newItems}}else if(url.includes("/2/direct_messages/user_list")){if(obj?.user_list?.length>0){obj.user_list=obj.user_list.filter((i)=>!["活动通知","闪聊"]?.includes(i?.user?.name))}}else if(url.includes("/2/flowlist")){if(obj?.items?.length>0){for(let item of obj.items){if(item?.items?.length>0){for(let i of item.items){removeVoteInfo(i?.data)}}}}if(obj?.channelInfo?.channels?.length>0){let newTabs=[];for(let tab of obj.channelInfo.channels){if(/_selfrecomm/.test(tab?.flowId)){continue}else if(/_chaohua/.test(tab?.flowId)){continue}else{newTabs.push(tab)}}obj.channelInfo.channels=newTabs}}else if(url.includes("/2/flowpage")){if(obj?.items?.length>0){let newItems=[];for(let item of obj.items){if(item?.items?.length>0){let newII=[];for(let i of item.items){if(i?.data.hasOwnProperty("promotion")){continue}else if(/_img_search_stick/.test(i?.data?.pic)){continue}else{newII.push(i)}}item.items=newII}newItems.push(item)}obj.items=newItems}}else if(url.includes("/2/groups/allgroups/v2")){if(obj?.pageDatas?.length>0){let newTabs=[];for(let item of obj.pageDatas){if(item?.pageDataType==="homeExtend"){continue}else{if(item?.categories?.length>0){let newCates=[];for(let i of item.categories){if(i?.title==="默认分组"){if(i?.pageDatas?.length>0){let newII=[];for(let ii of i.pageDatas){if(["最新微博","特别关注","好友圈","视频"]?.includes(ii?.title)){newII.push(ii)}else{continue}if(ii?.title==="最新微博"){ii.title="微博"}}i.pageDatas=newII}}newCates.push(i)}item.categories=newCates}newTabs.push(item)}}obj.pageDatas=newTabs}}else if(url.includes("/2/messageflow/notice")){if(obj?.messages?.length>0){let newMsgs=[];for(let msg of obj.messages){if(msg?.msg_card?.ad_tag){continue}else{newMsgs.push(msg)}}obj.messages=newMsgs}}else if(url.includes("/2/page")){if(obj?.cards?.length>0){if(obj?.cards?.[0]?.card_group?.length>0){obj.cards[0].card_group=obj.cards[0].card_group.filter((c)=>!(c?.actionlog?.ext?.includes("ads_word")||c?.itemid?.includes("t:51")||c?.itemid?.includes("ads_word")))}obj.cards=obj.cards.filter((i)=>!(i.itemid?.includes("feed_-_invite")||i.itemid?.includes("infeed_friends_recommend")||i.itemid?.includes("infeed_may_interest_in")||i.itemid?.includes("infeed_pagemanual3")||i.itemid?.includes("infeed_weibo_mall")||i?.mblog?.mblogtypename?.includes("广告")))}else if(obj?.card_group?.length>0){obj.card_group=obj.card_group.filter((i)=>i?.desc?.includes("你可能感兴趣的超话"))}}else if(url.includes("/2/profile/container_timeline")){if(obj?.loadedInfo?.follow_guide_info){delete obj.loadedInfo.follow_guide_info}if(obj?.items?.length>0){let newItems=[];for(let item of obj.items){if(item?.category==="card"){if([58,216]?.includes(item?.data?.card_type)){if(/没有公开博文，为你推荐以下精彩内容/.test(item?.data?.name)){continue}else{newItems.push(item)}}}else if(item?.category==="group"){if(item?.header?.data?.icon){delete item.header.data.icon}if(item?.itemId?.includes("INTEREST_PEOPLE")){continue}if(item?.profile_type_id==="weibo_cardpics"){continue}if(item?.items?.length>0){let newII=[];for(let ii of item.items){if(ii?.category==="feed"){removeAvatar(ii?.data);removeFeedAd(ii?.data);removeVoteInfo(ii?.data);if(ii?.data?.enable_comment_guide){ii.data.enable_comment_guide=false}}else if(ii?.category==="card"){if([48,176]?.includes(ii?.data?.card_type)){continue}if(ii?.data?.rightImage){delete ii.data.rightImage}if(ii?.data?.backgroundImage){delete ii.data.backgroundImage}}newII.push(ii)}item.items=newII}newItems.push(item)}else if(item?.category==="feed"){if(item?.data){if(!isAd(item?.data)){removeFeedAd(item?.data);removeVoteInfo(item?.data);if(item?.data?.source?.includes("生日动态")){continue}if(item?.data?.title?.text!=="热门"&&item?.data?.title?.structs?.length>0){continue}if(item?.data?.cleaned!==true){continue}newItems.push(item)}}}}obj.items=newItems}}else if(url.includes("/2/profile/dealatt")||url.includes("/2/friendships/")){if(obj?.cards?.length>0){obj.cards=[]}if(obj?.toolbar_menus_new?.items?.length>0){let toolbar=obj.toolbar_menus_new;let newTools=[];for(let item of toolbar.items){if(item?.identifier==="recommend"){continue}else if(/reward_/.test(item?.identifier)){continue}else{newTools.push(item)}}toolbar.items=newTools}}else if(url.includes("/2/profile/me")){if(obj?.vipHeaderBgImage){delete obj.vipHeaderBgImage}if(obj?.items?.length>0){let newItems=[];for(let item of obj.items){let itemId=item.itemId;if(itemId==="profileme_mine"){if(item?.header){delete item.header.vipView;delete item.header.vipCenter;delete item.header.vipIcon}if(item?.items?.length>0){for(let d of item.items){if(d.itemId==="mainnums_friends"){let s=d.click.modules[0].scheme;d.click.modules[0].scheme=s.replace("231093_-_selfrecomm","231093_-_selffollowed")}}}newItems.push(item)}else if(itemId==="100505_-_top8"){if(item?.items?.length>0){item.items=item.items.filter((i)=>i.itemId==="100505_-_album"||i.itemId==="100505_-_like"||i.itemId==="100505_-_watchhistory"||i.itemId==="100505_-_draft"||i.itemId==="100505_-_pay"||i.itemId==="100505_-_ordercenter"||i.itemId==="100505_-_productcenter"||i.itemId==="100505_-_promote")}newItems.push(item)}else if(itemId==="100505_-_manage"){if(item?.style){delete item.style}if(item?.images){delete item.images}newItems.push(item)}else if(itemId==="100505_-_manage2"){delete item.style}else if(itemId==="100505_-_chaohua"||itemId==="100505_-_recentlyuser"){newItems.push(item)}else{continue}}obj.items=newItems}}else if(url.includes("/2/profile/statuses/tab")){if(obj?.cards?.length>0){let newCards=[];for(let card of obj.cards){if(card?.card_group?.length>0){let newGroup=[];for(let group of card.card_group){let cardType=group.card_type;if([22]?.includes(cardType)){continue}if(group?.mblog){removeAvatar(group?.mblog);removeVoteInfo(group?.mblog)}newGroup.push(group)}card.card_group=newGroup;newCards.push(card)}else{if(card?.mblog){removeAvatar(card?.mblog);removeVoteInfo(card?.mblog)}newCards.push(card)}}obj.cards=newCards}if(obj?.cardlistInfo?.page_type==="08"){delete obj.cardlistInfo}}else if(url.includes("/2/profile/userinfo")){if(obj?.footer?.data){let toolbar=obj.footer.data.toolbar_menus_new;if(toolbar?.items?.length>0){let newTools=[];for(let item of toolbar.items){if(item?.identifier==="recommend"){continue}else if(item?.identifier==="urge"){continue}else if(/reward_/.test(item?.identifier)){continue}else{newTools.push(item)}}toolbar.items=newTools}if(toolbar?.lottie_guide){delete toolbar.lottie_guide}if(toolbar?.servicePopup?.subData){delete toolbar.servicePopup.subData}}if(obj?.header?.data){let head=obj.header.data.userInfo;if(head?.avatar_extend_info){delete head.avatar_extend_info}}if(obj?.profileSkin?.data){delete obj.profileSkin.data}}else if(url.includes("/2/search/")){if(url.includes("container_timeline")){if(obj?.items?.length>0){let newItems=[];for(let item of obj.items){if(item?.category==="feed"){if(!isAd(item?.data)){removeFeedAd(item?.data);newItems.push(item)}}else if(item?.category==="card"){if([19,118,206,208,217,249]?.includes(item?.data?.card_type)){continue}else{newItems.push(item)}}else if(item?.category==="cell"){newItems.push(item)}else if(item?.category==="group"){if(item?.items?.length>0){let newII=[];for(let ii of item.items){if([118,182,217,247]?.includes(ii?.data?.card_type)){continue}else{newII.push(ii)}}item.items=newII}newItems.push(item)}}obj.items=newItems}if(obj?.loadedInfo){delete obj?.loadedInfo}}else if(url.includes("finder")){let channels=obj.channelInfo.channels;if(channels?.length>0){for(let channel of channels){let payload=channel.payload;if(payload){if(payload?.loadedInfo){if(payload?.loadedInfo?.searchBarContent?.length>0){payload.loadedInfo.searchBarContent=[]}if(payload?.loadedInfo?.headerBack?.channelStyleMap){delete payload.loadedInfo.headerBack.channelStyleMap}if(payload?.loadedInfo?.searchBarStyleInfo){delete payload.loadedInfo.searchBarStyleInfo}}if(payload?.items?.length>0){let newItems=[];for(let item of payload.items){if(item?.category==="feed"){if(!isAd(item?.data)){removeFeedAd(item.data);newItems.push(item)}}else if(item?.category==="card"){if([19,118,206,208,217,249]?.includes(item?.data?.card_type)){continue}else{newItems.push(item)}}else if(item?.category==="cell"){newItems.push(item)}else if(item?.category==="group"){if(item?.items?.length>0){let newII=[];for(let ii of item.items){if([118,182,192,217,247]?.includes(ii?.data?.card_type)){continue}else{newII.push(ii)}}item.items=newII}newItems.push(item)}}payload.items=newItems}}}}}}else if(url.includes("/2/searchall")){if(obj?.header?.data){const items=["bg_img","background_scheme","background_url"];for(let i of items){delete obj.header.data[i]}}if(obj?.cards?.length>0){let newCards=[];for(let card of obj.cards){if(card?.card_group?.length>0){let newGroup=[];for(let group of card.card_group){if(group?.card_type===22){continue}else if(group?.card_type===42&&group?.title_extra_text==="广告"){continue}else if(group?.card_type===3&&group?.pics?.length>0){continue}else{if(group?.mblog){if(!isAd(group?.mblog)){removeAvatar(group?.mblog);if(group?.mblog?.title_source){delete group.mblog.title_source}if(group?.mblog?.source_tag_struct){delete group.mblog.source_tag_struct}if(group?.mblog?.extend_info){delete group.mblog.extend_info}if(group?.mblog?.common_struct){delete group.mblog.common_struct}removeVoteInfo(group?.mblog);if(group?.mblog?.is_ad===1){continue}newGroup.push(group)}}else{newGroup.push(group)}}}card.card_group=newGroup;newCards.push(card)}else{if(card?.mblog){if(!isAd(card?.mblog)){removeAvatar(card?.mblog);if(card?.mblog?.title_source){delete card.mblog.title_source}if(card?.mblog?.source_tag_struct){delete card.mblog.source_tag_struct}if(card?.mblog?.extend_info){delete card.mblog.extend_info}if(card?.mblog?.common_struct){delete card.mblog.common_struct}removeVoteInfo(card?.mblog);if(card?.mblog?.page_info?.cards?.length>0){let page=card.mblog.page_info;for(let i of page.cards){if(i?.media_info?.vote_info){delete i.media_info.vote_info}}}newCards.push(card)}}}}obj.cards=newCards}if(obj?.items?.length>0){let newItems=[];for(let item of obj.items){if(!isAd(item?.data)){if(item?.category==="feed"){removeFeedAd(item?.data);removeVoteInfo(item?.data);newItems.push(item)}else if(item?.category==="group"){if(item?.items?.length>0){let newII=[];for(let ii of item.items){if(!isAd(ii?.data)){if(ii?.data){removeAvatar(ii?.data);if([22,89]?.includes(ii?.data?.card_type)){continue}if(ii?.data?.card_type===42&&ii?.data?.is_ads===true){continue}}newII.push(ii)}}item.items=newII}newItems.push(item)}else{newItems.push(item)}}}obj.items=newItems}}else if(url.includes("/2/statuses/container_timeline_hot")||url.includes("/2/statuses/unread_hot_timeline")){for(let s of["ad","advertises","trends","headers"]){if(obj?.[s]){delete obj[s]}}if(obj?.items?.length>0){let newItems=[];for(let item of obj.items){if(!isAd(item?.data)){if(item?.category==="feed"){removeFeedAd(item?.data);removeVoteInfo(item?.data);newItems.push(item)}else{continue}}}obj.items=newItems}if(obj?.statuses?.length>0){let newStatuses=[];for(let item of obj.statuses){if(!isAd(item)){removeFeedAd(item);newStatuses.push(item)}}obj.statuses=newStatuses}}else if(url.includes("/2/statuses/container_timeline?")||url.includes("/2/statuses/container_timeline_unread")){if(obj?.loadedInfo?.headers){delete obj.loadedInfo.headers}if(obj?.common_struct){delete obj?.common_struct}if(obj?.items?.length>0){let newItems=[];for(let item of obj.items){if(!isAd(item?.data)){if(item?.category==="feed"){removeFeedAd(item?.data);if(item.data?.title?.structs){continue}if(item?.data?.action_button_icon_dic){delete item.data.action_button_icon_dic}removeVoteInfo(item?.data);if(item?.data?.screen_name_suffix_new?.length>0){if(item?.data?.screen_name_suffix_new?.[3]?.content==="快转了"){continue}}if(item?.data?.title?.text?.includes("精选")){continue}if(item?.data?.user?.following===false){continue}if(item?.data?.user?.unfollowing_recom_switch===1){item.data.user.unfollowing_recom_switch=0}if(item?.data?.tag_struct?.length>0){item.data.tag_struct=[]}newItems.push(item)}else if(item?.category==="feedBiz"){newItems.push(item)}else{continue}}}obj.items=newItems}}else if(url.includes("/2/statuses/container_timeline_topic")){if(obj?.header?.data?.follow_guide_info){delete obj.header.data.follow_guide_info}if(obj?.items?.length>0){let newItems=[];for(let item of obj.items){if(item?.category==="feed"){if(item.data){removeAvatar(item?.data);if(!isAd(item?.data)){if(item?.data?.title?.text?.includes("新人导师")){delete item.data.title}newItems.push(item)}}}else if(item?.category==="card"){if(![4,197,1012]?.includes(item?.data?.card_type)){newItems.push(item)}}else if(item?.category==="group"){if(item?.items?.length>0){if(item?.itemId===null){let newII=[];for(let ii of item.items){if(ii?.data?.hasOwnProperty("itemid")){if(ii?.data?.itemid?.includes("mine_topics")){newII.push(ii)}else if(ii?.data?.itemid?.includes("tab_search_input")){if(ii?.data?.hotwords){ii.data.hotwords=[{word:"搜索超话"}]}newII.push(ii)}else if(ii?.data?.itemid?.includes("poiRankList")){newII.push(ii)}}else{newII.push(ii)}removeAvatar(ii?.data);item.items=newII}}else{for(let ii of item.items){if(ii?.data){removeAvatar(ii?.data);if(ii?.data?.common_struct){delete ii.data.common_struct}}}}}if(item?.style?.topHover){delete item.style.topHover}if(item?.header?.arrayText?.contents?.length>0){continue}newItems.push(item)}else{continue}}obj.items=newItems}}else if(url.includes("/2/statuses/extend")){if(obj?.trend?.extra_struct?.extBtnInfo?.btn_picurl?.includes("ad")){delete obj.trend}if(obj.trend?.titles){let title=obj.trend.titles.title;if(["博主好物种草","相关推荐"]?.includes(title)){delete obj.trend}}const item=["bubble_guide_data","button_extra_info","display_info","extend_info","floating_button","follow_data","head_cards","highlight","interaction_extra_info","page_alerts","reward_info","source_tag_struct"];if(obj){item.forEach((i)=>{delete obj[i]})}if(obj?.custom_action_list?.length>0){let newActions=[];for(let item of obj.custom_action_list){let type=item.type;let add=itemMenusConfig[type];if(type==="mblog_menus_copy_url"){newActions.unshift(item)}else if(add){newActions.push(item)}}obj.custom_action_list=newActions}if(obj?.has_common_struct){obj.has_common_struct=false}if(obj?.enable_comment_guide){obj.enable_comment_guide=false}}else if(url.includes("/2/statuses/show")){removeFeedAd(obj);if(obj?.text){removeFeedAd(obj.text)}if(obj?.reward_info){delete obj.reward_info}removeVoteInfo(obj)}else if(url.includes("/2/video/tiny_stream_video_list")){if(obj?.statuses?.length>0){obj.statuses=[]}if(obj?.tab_list?.length>0){obj.tab_list=[]}}else if(url.includes("/2/!/huati/discovery_home_bottom_channels")){if(obj?.button_configs){delete obj.button_configs}if(obj?.channelInfo?.channel_list?.length>0){obj.channelInfo.channel_list=obj.channelInfo.channel_list.filter((t)=>t.title!=="广场")}}else if(url.includes("/aj/appicon/list")){if(obj?.data?.list?.length>0){for(let item of obj.data.list){if(item?.cardType){item.cardType=2}}}}else if(url.includes("/v1/ad/preload")){if(obj?.ads?.length>0){for(let item of obj.ads){item.start_time=3818332800;item.end_time=3818419199;item.daily_display_cnt=50;item.display_duration=0}if(obj?.ads?.creatives?.length>0){for(let item of obj.ads.creatives){item.start_time=3818332800;item.end_time=3818419199;item.daily_display_cnt=50;item.display_duration=0}}}}else if(url.includes("/wbapplua/wbpullad.lua")||url.includes("/preload/get_ad")){if(obj?.cached_ad?.ads?.length>0){for(let item of obj.cached_ad.ads){item.show_count=50;item.duration=0;item.start_date=3818332800;item.end_date=3818419199}}}$done({body:JSON.stringify(obj)})}function isAd(data){if(data?.mblogtypename?.includes("广告")){return true}if(data?.mblogtypename?.includes("热推")){return true}if(data?.promotion?.type?.includes("ad")){return true}if(data?.content_auth_info?.content_auth_title?.includes("广告")){return true}if(data?.ads_material_info?.is_ads===true){return true}return false}function removeAvatar(data){if(data?.buttons){delete data.buttons}if(data?.cardid){delete data.cardid}if(data?.icons){delete data.icons}if(data?.mblog_buttons){delete data.mblog_buttons}if(data?.pic_bg_new){delete data.pic_bg_new}if(data?.user?.avatargj_id){delete data.user.avatargj_id}if(data?.user?.avatar_extend_info){delete data.user.avatar_extend_info}if(data?.user?.cardid){delete data.user.cardid}if(data?.user?.icons){delete data.user.icons}if(data?.user?.mbtype){delete data.user.mbtype}}function removeFeedAd(item){removeAvatar(item);if(item?.retweeted_status){removeAvatar(item?.retweeted_status)}if(item?.common_struct){delete item.common_struct}if(item?.comment_summary){delete item.comment_summary}}function removeVoteInfo(item){if(item?.page_info?.media_info?.vote_info){delete item.page_info.media_info.vote_info}}